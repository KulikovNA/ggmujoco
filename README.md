# generate grasp in MuJoCo

![view](media/mujoco.png "Ğ’Ğ¸Ğ´ Ğ¸Ğ· ÑĞ¸Ğ¼ÑƒĞ»ÑÑ‚Ğ¾Ñ€Ğ°")

*MuJoCoâ€‘powered RGBâ€‘D camera + coloured pointâ€‘cloud export in <Â 100Â lines of Python.*

---

## 1Â Â·Â Ğ§Ñ‚Ğ¾Â ÑÑ‚Ğ¾

Ğ­Ñ‚Ğ¾Ñ‚ Ñ€ĞµĞ¿Ğ¾Ğ·Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ¹ Ğ·Ğ°Ğ¿ÑƒÑĞºĞ°ĞµÑ‚ Ğ²Ğ¸Ñ€Ñ‚ÑƒĞ°Ğ»ÑŒĞ½ÑƒÑ ĞºĞ°Ğ¼ĞµÑ€Ñƒ **IntelÂ RealSenseÂ D435i** Ğ² Ñ„Ğ¸Ğ·Ğ¸Ñ‡ĞµÑĞºĞ¾Ğ¼ Ğ´Ğ²Ğ¸Ğ¶ĞºĞµ **MuJoCoÂ 3.x**. Ğ¡ĞºÑ€Ğ¸Ğ¿Ñ‚ `scripts/run.py`â€‘

- Ğ²Ñ‹Ğ²Ğ¾Ğ´Ğ¸Ñ‚ Ğ¿Ğ¾Ñ‚Ğ¾Ğº **RGB** (OpenCV)
![view](media/rgb.png "Ğ’Ğ¸Ğ´ Ğ¸Ğ· ÑĞ¸Ğ¼ÑƒĞ»ÑÑ‚Ğ¾Ñ€Ğ°")
- Ğ²Ğ¸Ğ·ÑƒĞ°Ğ»Ğ¸Ğ·Ğ¸Ñ€ÑƒĞµÑ‚ Ğ² Ñ€ĞµĞ°Ğ»ÑŒĞ½Ğ¾Ğ¼ Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ¸ **pointÂ cloud** (Open3D)
![view](media/pointcloud.png "Ğ’Ğ¸Ğ´ Ğ¸Ğ· ÑĞ¸Ğ¼ÑƒĞ»ÑÑ‚Ğ¾Ñ€Ğ°")
- Ñ‡ĞµÑ€ĞµĞ· `SAVE_AFTER`Â ÑĞµĞºÑƒĞ½Ğ´ ÑĞ¾Ñ…Ñ€Ğ°Ğ½ÑĞµÑ‚ Ñ†Ğ²ĞµÑ‚Ğ½Ğ¾Ğµ Ğ¾Ğ±Ğ»Ğ°ĞºĞ¾ Ñ‚Ğ¾Ñ‡ĞµĞº Ğ²:
  - `cloud_000.ply`Â â€” Ğ±Ğ¸Ğ½Ğ°Ñ€Ğ½Ñ‹Ğ¹ PLY (ÑĞ¶Ğ°Ñ‚Ñ‹Ğ¹)
  - `cloud_000.npy`Â â€” NumPy `float32[N,3]`

Ğ’ ÑÑ†ĞµĞ½Ğµ ÑƒĞ¶Ğµ Ñ€Ğ°ÑÑÑ‚Ğ°Ğ²Ğ»ĞµĞ½Ñ‹ Ğ¼ĞµÑˆĞ¸Â ğŸ°Â `bunny`, ğŸ¶Â `dog`, ğŸ±Â `cat` Ğ¸ Ğ´Ğ¾Ğ¼Â ğŸ Â `house` Ğ´Ğ»Ñ Ğ½Ğ°Ğ³Ğ»ÑĞ´Ğ½Ğ¾ÑÑ‚Ğ¸.

---

## 2Â Â·Â Ğ—Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚Ğ¸

- PythonÂ â‰¥Â 3.9
- MuJoCoÂ â‰¥Â 3.1Â (+Â `pip install mujoco`)
- Open3D, OpenCV, NumPy
- (Ğ¾Ğ¿Ñ†.) **GitÂ LFS**Â â€” ĞµÑĞ»Ğ¸ Ñ…Ñ€Ğ°Ğ½Ğ¸Ñ‚Ğµ Ğ±Ğ¾Ğ»ÑŒÑˆĞ¸Ğµ PLY/NPY Ğ² Ñ€ĞµĞ¿Ğ¾

Ğ’ÑĞµ Ğ¿Ğ°ĞºĞµÑ‚Ñ‹ Ğ¿ĞµÑ€ĞµÑ‡Ğ¸ÑĞ»ĞµĞ½Ñ‹ Ğ² `requirements.txt`Â â€” ÑƒÑÑ‚Ğ°Ğ½Ğ°Ğ²Ğ»Ğ¸Ğ²Ğ°ÑÑ‚ÑÑ Ğ¾Ğ´Ğ½Ğ¾Ğ¹ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ğ¾Ğ¹.

---

## 3Â Â·Â Ğ‘Ñ‹ÑÑ‚Ñ€Ñ‹Ğ¹ ÑÑ‚Ğ°Ñ€Ñ‚

```bash
# ĞšĞ»Ğ¾Ğ½Ğ¸Ñ€ÑƒĞµĞ¼ (+ menagerieâ€‘Ğ¿Ğ¾Ğ´Ğ¼Ğ¾Ğ´ÑƒĞ»ÑŒ Ğ´Ğ»Ñ Ğ¼ĞµÑˆĞµĞ¹)
git clone --recursive https://github.com/dakolzin/sim_d435
cd sim_d435

# Ğ›Ğ¾ĞºĞ°Ğ»ÑŒĞ½Ğ¾Ğµ Ğ¾ĞºÑ€ÑƒĞ¶ĞµĞ½Ğ¸Ğµ
python -m venv env && source env/bin/activate
pip install -r requirements.txt

# Ğ—Ğ°Ğ¿ÑƒÑĞº ÑĞ¸Ğ¼ÑƒĞ»ÑÑ†Ğ¸Ğ¸
python scripts/run.py
```

Ğ§ĞµÑ€ĞµĞ· \~20Â ÑĞµĞºÑƒĞ½Ğ´ Ğ² ĞºĞ¾Ñ€Ğ½Ğµ Ğ¿Ğ¾ÑĞ²ÑÑ‚ÑÑ `cloud_000.ply/.npy`.

---

## 4Â Â·Â Ğ¡Ñ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ°

```
.
â”œâ”€â”€ scripts/            # Ğ¢Ğ¾Ñ‡ĞºĞ¸ Ğ²Ñ…Ğ¾Ğ´Ğ°
â”‚   â”œâ”€â”€ run.py          # Ğ³Ğ»Ğ°Ğ²Ğ½Ñ‹Ğ¹ ÑĞºÑ€Ğ¸Ğ¿Ñ‚ (ÑĞ¼. Ğ½Ğ¸Ğ¶Ğµ)
â”‚   â””â”€â”€ man.py          # Ğ²ÑĞ¿Ğ¾Ğ¼. ÑƒÑ‚Ğ¸Ğ»Ğ¸Ñ‚Ñ‹ (Ğ½ĞµĞ¾Ğ±ÑĞ·Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ğ¾)
â”œâ”€â”€ mjcf/               # MJCFâ€‘ÑÑ†ĞµĞ½Ğ° Ğ¸ Ğ°ÑÑĞµÑ‚Ñ‹
â”‚   â”œâ”€â”€ test.xml        # ĞºĞ°Ğ¼ĞµÑ€Ğ° + Ğ¾Ğ±ÑŠĞµĞºÑ‚Ñ‹ + ÑĞ²ĞµÑ‚
â”‚   â””â”€â”€ assets/         # .obj/.stl (Ñ‡Ğ°ÑÑ‚ÑŒ â€”Â symlink Ğ¸Ğ· external/menagerie)
â”œâ”€â”€ frames/             # ĞºĞ°Ğ´Ñ€Ñ‹, Ğ³ĞµĞ½ĞµÑ€Ğ¸Ñ€ÑƒĞµĞ¼Ñ‹Ğµ ÑĞºÑ€Ğ¸Ğ¿Ñ‚Ğ¾Ğ¼ (Ğ¸Ğ³Ğ½Ğ¾Ñ€Ğ¸Ñ€ÑƒÑÑ‚ÑÑ Gitâ€™Ğ¾Ğ¼)
â”œâ”€â”€ requirements.txt
â””â”€â”€ README.md
```

---

## 5Â Â·Â `run.py`Â â€” ĞºĞ»ÑÑ‡ĞµĞ²Ñ‹Ğµ Ğ¿Ğ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€Ñ‹

| ĞšĞ¾Ğ½ÑÑ‚Ğ°Ğ½Ñ‚Ğ°    | Ğ—Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ Ğ¿Ğ¾ ÑƒĞ¼Ğ¾Ğ»Ñ‡Ğ°Ğ½Ğ¸Ñ | ĞĞ°Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ                              |
| ------------ | --------------------- | --------------------------------------- |
| `CAM`        | `"d435"`              | Ğ¸Ğ¼Ñ ĞºĞ°Ğ¼ĞµÑ€Ñ‹ Ğ² MJCF                       |
| `H, W`       | `480, 640`            | offâ€‘screen Ñ€ĞµĞ½Ğ´ĞµÑ€                       |
| `SAVE_AFTER` | `20.0`Â ÑĞµĞº            | Ğ·Ğ°Ğ´ĞµÑ€Ğ¶ĞºĞ° Ğ¿ĞµÑ€ĞµĞ´ Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸Ğ¼ ÑĞºÑĞ¿Ğ¾Ñ€Ñ‚Ğ¾Ğ¼ |
| `OUT_PLY`    | `cloud_000.ply`       | Ğ¸Ğ¼Ñ PLYâ€‘Ñ„Ğ°Ğ¹Ğ»Ğ°                           |
| `OUT_NPY`    | `cloud_000.npy`       | Ğ¸Ğ¼Ñ NumPyâ€‘Ñ„Ğ°Ğ¹Ğ»Ğ°                         |

Ğ˜Ğ·Ğ¼ĞµĞ½Ğ¸Ñ‚Ğµ Ğ¸Ñ… Ğ¿Ñ€ÑĞ¼Ğ¾ Ğ² ĞºĞ¾Ğ´Ğµ Ğ¸Ğ»Ğ¸ Ğ¿ĞµÑ€ĞµĞ´Ğ°Ğ²Ğ°Ğ¹Ñ‚Ğµ Ñ‡ĞµÑ€ĞµĞ· Ğ¿ĞµÑ€ĞµĞ¼ĞµĞ½Ğ½Ñ‹Ğµ Ğ¾ĞºÑ€ÑƒĞ¶ĞµĞ½Ğ¸Ñ.

---

## 6Â Â·Â ĞŸĞ¾Ğ²Ñ‚Ğ¾Ñ€Ğ½Ğ¾Ğµ ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ Ğ¾ĞºÑ€ÑƒĞ¶ĞµĞ½Ğ¸Ñ

```bash
python -m venv env
source env/bin/activate
python -m pip install -r requirements.txt
```

Ğ”Ğ»Ñ **conda** Ğ²Ğ¼ĞµÑÑ‚Ğ¾ ÑÑ‚Ğ¾Ğ³Ğ¾:

```bash
conda env create -f environment.yml && conda activate env
```

---

## 7Â Â·Â ToÂ Do

- ğŸ®Â CLIâ€‘Ğ°Ñ€Ğ³ÑƒĞ¼ĞµĞ½Ñ‚Ñ‹ Ğ²Ğ¼ĞµÑÑ‚Ğ¾ Ñ…Ğ°Ñ€Ğ´ĞºĞ¾Ğ´Ğ°
- ğŸ–¼ï¸Â Ñ€ÑĞ½Ğ´Ğ¾Ğ¼Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ Ğ¿Ğ¾Ğ· Ğ¸ Ğ¼Ğ°Ñ‚ĞµÑ€Ğ¸Ğ°Ğ»Ğ¾Ğ² Ğ¾Ğ±ÑŠĞµĞºÑ‚Ğ¾Ğ² Ğ´Ğ»Ñ Ğ´Ğ°Ñ‚Ğ°ÑĞµÑ‚Ğ¾Ğ²
- ğŸ“¦Â Dockerfile +Â GitHubÂ Actions

---
